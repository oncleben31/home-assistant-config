---
# Script to pilot the Xioami Vacuum when the map is reseted.
#
# this script will make the robot go in all house to reconstruct
# the map
#
# https://www.home-assistant.io/components/vacuum/
# https://www.home-assistant.io/components/vacuum.xiaomi_miio/
# https://www.home-assistant.io//getting-started/scripts/
#
vacuum_map_construct:
  alias: Constuire la map de Rocky
  sequence:
    # first put the fan_speed at minimum to avoid noise
    - service: vacuum.set_fan_speed
      data: 
        entity_id: vacuum.xiaomi_vacuum_cleaner
        fan_speed: quiet

    # launch a standard clean during 10 secondes to create the first part of the map
    - service: vacuum.start
      data: 
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - delay:
        seconds: 20
    - service: vacuum.stop
      data: 
        entity_id: vacuum.xiaomi_vacuum_cleaner

    # send goto_target commands to pilot the robot thru the house
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_goto_target
        params: [27500,25500]
    - delay: '00:00:10'
    - wait_template: "{{ is_state('vacuum.xiaomi_vacuum_cleaner', 'idle') }}"
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_goto_target
        params: [25500,22300]
    - delay: '00:00:10'
    - wait_template: "{{ is_state('vacuum.xiaomi_vacuum_cleaner', 'idle') }}"
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_goto_target
        params: [21600,21600]
    - delay: '00:00:10'
    - wait_template: "{{ is_state('vacuum.xiaomi_vacuum_cleaner', 'idle') }}"
    - service: vacuum.send_command
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        command: app_goto_target
        params: [21600,24000]
    - delay: '00:00:05'
    - wait_template: "{{ is_state('vacuum.xiaomi_vacuum_cleaner', 'idle') }}"
    
    